# 小说章节概括工具使用指南

## 📋 项目概述

本工具专门用于处理 `test.csv` 文件中的小说章节数据，使用 Qwen 系列模型对每个章节进行智能概括，并将所有章节的概括整合为一段完整的故事梗概。

## 📁 文件结构

```
📦 项目目录
├── 📄 test.csv                      # 输入数据文件（包含20章小说内容）
├── 🐍 chapter_summarizer_fixed.py   # ⭐ 主要脚本（推荐使用）
├── 🐍 simple_test.py                # 数据格式验证脚本
├── 🐍 test_data_parsing.py          # 详细数据解析测试脚本
├── 🐍 chapter_summarizer.py         # 基础版本脚本
├── 🐍 chapter_summarizer_qwen3.py   # Qwen3-8B 优化版本
├── 📄 requirements.txt              # Python 依赖包
├── 📖 README.md                     # 英文说明文档
└── 📖 使用指南.md                   # 中文使用指南（本文件）
```

## 🔍 数据验证结果

✅ **数据格式检查通过！**
- CSV文件包含 33 列数据
- `chapters_text` 列位于第 31 列
- 数据格式：JSON字符串，包含 20 个章节
- 每章平均约 1,890 字
- 总内容约 37,793 字符

### 📚 章节概览
- 第01章：解开你的腰带 (1,813 字)
- 第02章：跪下 (1,356 字) 
- 第03章：鞭笞 (1,853 字)
- ... 共20章

## 🚀 快速开始

### 第一步：验证数据格式
```bash
python3 simple_test.py
```
预期输出：
```
✅ 数据格式验证成功！
📚 章节数量: 20
```

### 第二步：安装依赖包
```bash
pip install -r requirements.txt
```

### 第三步：运行主程序
```bash
python3 chapter_summarizer_fixed.py
```

## 📊 处理流程

1. **数据加载** 📁
   - 读取 `test.csv` 文件
   - 解析 `chapters_text` 列的JSON数据
   - 验证章节数据完整性

2. **模型加载** 🤖
   - 自动加载 Qwen/Qwen2.5-3B-Instruct 模型
   - 支持GPU加速（如有CUDA环境）
   - 自动处理模型兼容性

3. **章节处理** ✍️
   - 逐章进行内容清理和预处理
   - 使用AI模型生成200字左右的概括
   - 实时显示处理进度

4. **结果整合** 📝
   - 整合所有章节概括
   - 生成完整故事梗概
   - 计算统计信息

5. **结果保存** 💾
   - 保存到 `novel_summary_result.txt`
   - 包含详细概括和整体梗概

## 📈 预期输出

### 控制台输出示例：
```
🎯 小说章节概括工具
==================================================
🚀 正在加载模型: Qwen/Qwen2.5-3B-Instruct
💻 使用设备: cuda
✅ 模型加载完成!

📁 正在读取文件: test.csv
📖 正在解析章节数据...
✅ JSON解析成功，解析出 20 个章节

🔄 开始处理 20 个章节...
============================================================
📖 [ 1/20] 正在处理: 第01章 解开你的腰带
📝 原文长度: 1813 字
✅ 概括完成: 186 字
----------------------------------------
📖 [ 2/20] 正在处理: 第02章 跪下
📝 原文长度: 1356 字
✅ 概括完成: 194 字
...
```

### 输出文件内容：
```
================================================================================
小说章节概括结果
================================================================================

【章节详细概括】
------------------------------------------------------------

章节编号：1
章节标题：第01章 解开你的腰带
原文长度：1813 字
概括长度：186 字
概括内容：沈从妩魂穿到现代，成为豪门谢家被边缘化的长媳...

【整合故事概括】
================================================================================

《当家主母，我在现代整治顶级豪门》前20章概括

【故事梗概】
古代首辅夫人沈从妩魂穿现代，成为豪门谢家不受宠的长媳...

【统计信息】
• 总章节数：20 章
• 原文总字数：37,793 字
• 概括总字数：3,800 字
• 有效概括章节：20 章
• 内容压缩比：10.1%
```

## ⚙️ 自定义配置

### 模型配置
如果您有 Qwen3-8B 模型访问权限，可修改脚本：
```python
# 在 chapter_summarizer_fixed.py 中修改
summarizer = ChapterSummarizerFixed("path/to/your/qwen3-8b")
```

### 概括参数调整
```python
# 修改概括长度
max_new_tokens=280  # 调整生成长度
temperature=0.3     # 调整创造性 (0-1)
```

## 🔧 故障排除

### 常见问题

**Q: 模型下载失败**
```bash
# 解决方案：使用镜像源
pip install transformers -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**Q: 内存不足**
```bash
# 解决方案：使用小模型或调整参数
torch_dtype=torch.float32  # 改用32位精度
```

**Q: GPU不可用**
```bash
# 解决方案：确认CUDA安装
python3 -c "import torch; print(torch.cuda.is_available())"
```

**Q: 生成质量不佳**
```bash
# 解决方案：调整生成参数
temperature=0.1      # 降低随机性
repetition_penalty=1.2  # 增加重复惩罚
```

## 📋 系统要求

### 最低要求
- Python 3.8+
- 8GB RAM
- 10GB 可用磁盘空间

### 推荐配置
- Python 3.9+
- 16GB+ RAM
- NVIDIA GPU (8GB+ 显存)
- 20GB+ 可用磁盘空间

## 📞 技术支持

如果遇到问题，请检查：
1. ✅ 数据格式是否正确（运行 `simple_test.py`）
2. ✅ 依赖包是否完整安装
3. ✅ 系统内存是否充足
4. ✅ 网络连接是否稳定（首次下载模型需要）

## 🎯 预期效果

本工具将为您的20章小说生成：
- **章节概括**：每章约200字的精炼概括
- **整体梗概**：约4000字的完整故事概括
- **压缩比**：约10%的内容压缩率
- **处理时间**：约15-30分钟（取决于硬件配置）

祝您使用愉快！ 🎉